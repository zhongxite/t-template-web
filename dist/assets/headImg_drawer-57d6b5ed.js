import{_ as E,f as m,s as J,j as P,y as T,r as d,o as b,g as x,b as a,w as s,a as D,u as e,z as M,A as O,k as R,l as p,F as z,B as A,c as $,t as q,C as H,v as U}from"./index-8906f66a.js";import{i as K}from"./defaultImg-9e4ff219.js";import{u as Q,g as W}from"./user-b4b83a6b.js";import{g as X}from"./role-15182004.js";const Y={class:"userBox"},Z={class:"btnBox"},ee={key:0,class:"fixBtn"},le={key:1,class:"subBtn"},ae={__name:"headImg_drawer",setup(te){let w=m(K),{userInfo:v}=J(P()),I=m([]),t=m({...v.value}),f=m([]);const k=n=>{const l=n.name.substring(n.name.lastIndexOf(".")+1);if(["jpg","jpeg","png","gif","JPG","JPEG","GIF"].indexOf(l)===-1)return U({message:"上传文件只能是 jpg、jpeg、png、gif格式",type:"error"}),!1;if(!(n.size/1024/1024<2))return U({message:"上传文件大小不能超过 2MB",type:"error"}),!1},B=n=>{t.value.avatar=n.data.url};let i=m(!1);const V=(n,l)=>{n=="fix"?t.value={...v.value}:v.value={...t.value},i.value=!i.value,r.value=!1,c.value=!1};let r=m(!1),c=m(!1);const F=()=>{r.value=!0,Q(t.value).then(n=>{n.code==200?W().then(l=>{l.code==200&&(v.value=l.data,setTimeout(()=>{r.value=!1,c.value=!0,setTimeout(()=>{V()},1e3)},1e3))}):r.value=!1}).catch(()=>{r.value=!1})};return X().then(n=>{n.code==200&&(I.value=n.data)}),T(()=>{f.value=[]}),(n,l)=>{const y=d("el-image"),_=d("el-button"),L=d("el-upload"),u=d("el-form-item"),g=d("el-input"),h=d("el-radio"),j=d("el-radio-group"),N=d("el-option"),S=d("el-select"),C=d("el-form"),G=d("el-scrollbar");return b(),x("div",Y,[a(G,{height:"calc(100vh - 200px)"},{default:s(()=>[a(C,{ref:"form",model:e(t),"label-width":"auto"},{default:s(()=>[a(u,{label:"头像",class:"formItem"},{default:s(()=>[a(y,{"close-on-press-escape":!1,"preview-src-list":[e(t).avatar?e(t).avatar:e(w)],class:"headImg",src:e(t).avatar?e(t).avatar:e(w),fit:"cover"},null,8,["preview-src-list","src"]),M(a(L,{"file-list":e(f),"onUpdate:fileList":l[0]||(l[0]=o=>R(f)?f.value=o:f=o),action:"http://localhost/api/common/uploadOss",multiple:"","before-upload":k,"show-file-list":!1,accept:".jpg,.jpeg,.png,.gif,.JPG,.JPEG,.GIF,","on-success":B},{default:s(()=>[a(_,{text:"",plain:"",bg:"",type:"primary"},{default:s(()=>[p("点击上传")]),_:1})]),_:1},8,["file-list"]),[[O,e(i)]])]),_:1}),a(u,{label:"姓名",prop:"name",class:"formItem"},{default:s(()=>[a(g,{disabled:!e(i),modelValue:e(t).name,"onUpdate:modelValue":l[1]||(l[1]=o=>e(t).name=o),type:"text",maxlength:"10","show-word-limit":"",clearable:""},null,8,["disabled","modelValue"])]),_:1}),a(u,{label:"性别",prop:"sex",class:"formItem"},{default:s(()=>[a(j,{modelValue:e(t).sex,"onUpdate:modelValue":l[2]||(l[2]=o=>e(t).sex=o),disabled:!e(i)},{default:s(()=>[a(h,{border:"",label:1},{default:s(()=>[p("男")]),_:1}),a(h,{border:"",label:2},{default:s(()=>[p("女")]),_:1}),a(h,{border:"",label:0},{default:s(()=>[p("未知")]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),a(u,{label:"手机号码",prop:"phone",class:"formItem"},{default:s(()=>[a(g,{modelValue:e(t).phone,"onUpdate:modelValue":l[3]||(l[3]=o=>e(t).phone=o),type:"text",disabled:!e(i),placeholder:"请更新手机号",maxlength:"11","show-word-limit":"",clearable:""},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"邮箱",prop:"email",class:"formItem"},{default:s(()=>[a(g,{modelValue:e(t).email,"onUpdate:modelValue":l[4]||(l[4]=o=>e(t).email=o),type:"text",disabled:!e(i),placeholder:"请更新邮箱","show-word-limit":"",clearable:""},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"登录账号名",prop:"accountName",class:"formItem"},{default:s(()=>[a(g,{disabled:"",modelValue:e(t).accountName,"onUpdate:modelValue":l[5]||(l[5]=o=>e(t).accountName=o),type:"text"},null,8,["modelValue"])]),_:1}),a(u,{label:"所属角色",prop:"role",class:"formItem"},{default:s(()=>[a(S,{disabled:!e(i),modelValue:e(t).role,"onUpdate:modelValue":l[6]||(l[6]=o=>e(t).role=o),placeholder:"请选择所属角色",clearable:""},{default:s(()=>[(b(!0),x(z,null,A(e(I),(o,oe)=>(b(),$(N,{label:o.name,value:o.id},null,8,["label","value"]))),256))]),_:1},8,["disabled","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),D("div",Z,[e(i)?(b(),x("div",le,[a(_,{class:"btn",icon:e(c)?e(H):"",type:"success",loading:e(r),onClick:F},{default:s(()=>[p(q(!e(r)&&!e(c)?"确认":e(c)?"修改成功":"正在提交"),1)]),_:1},8,["icon","loading"]),a(_,{class:"btn",onClick:l[8]||(l[8]=o=>V("fix"))},{default:s(()=>[p("取消")]),_:1})])):(b(),x("div",ee,[a(_,{class:"btn",type:"warning",onClick:l[7]||(l[7]=o=>V("fix"))},{default:s(()=>[p("修改信息")]),_:1})]))])])}}},re=E(ae,[["__scopeId","data-v-0f1a524c"]]);export{re as default};
